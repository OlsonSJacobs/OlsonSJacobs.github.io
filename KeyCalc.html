<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KeyCalc (R0.05)</title>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; }
  header { background:#333; color:#fff; padding:6px 10px; font-weight:bold; }
  .menubar { background:#eee; padding:4px 8px; display:flex; gap:8px; border-bottom:1px solid #ccc; }
  .menubar button { padding:4px 8px; font-size:12px; }
  /* R0.06 width (twice as wide) preserved */
  #app { width:520px; height:240px; margin:10px; background:#fff; border:1px solid #bbb; position:relative; }
  #stackView { position:absolute; left:10px; top:30px; width:500px; height:130px; overflow-y:auto; border:1px solid #ccc; }
  table.stack { width:100%; border-collapse:collapse; font-size:12px; }
  table.stack thead th { background:#fafafa; border-bottom:1px solid #ddd; text-align:left; padding:2px; }
  table.stack tbody td { border-bottom:1px solid #f0f0f0; padding:2px; }
  #status { position:absolute; left:10px; top:165px; width:500px; height:20px; border:1px solid #444; background:#eee; text-align:center; line-height:20px; font-size:12px; }
  #cmd { position:absolute; left:10px; top:190px; width:500px; height:22px; box-sizing:border-box; }
  .panel { position:fixed; right:10px; top:50px; width:420px; max-height:60vh; overflow:auto; background:#fff; border:1px solid #999; box-shadow:0 2px 8px rgba(0,0,0,.2); display:none; }
  .panel header { background:#444; color:#fff; padding:6px 8px; font-size:13px; }
  .panel .content { padding:8px; font-size:12px; }
  .close { float:right; background:#fff; color:#000; border:1px solid #ccc; font-size:11px; padding:1px 6px; cursor:pointer; }
  .kv { display:grid; grid-template-columns: 140px 1fr; gap:6px; }
  .kv div { padding:2px 0; border-bottom:1px dashed #eee; }
</style>
</head>
<body>
  <header>KeyCalc (R0.05)</header>
  <div class="menubar">
    <button id="btnFunctions">Functions</button>
    <button id="btnScripts">Scripts</button>
    <button id="btnUnits">Units</button>
    <button id="btnSave">Save Stack</button>
    <button id="btnClear">Clear</button>
  </div>
  <div id="app">
    <div id="stackView">
      <table class="stack">
        <thead>
          <!-- R0.06 header: Reg, Name, Value (Value includes value/base/units) -->
          <tr><th style="width:31px">Reg</th><th style="width:50px">Name</th><th>Value</th></tr>
        </thead>
        <tbody id="stackBody"></tbody>
      </table>
    </div>
    <div id="status">...</div>
    <input id="cmd" type="text" placeholder="type command and press Enter" />
  </div>

  <div id="panelFunctions" class="panel">
    <header>Functions <button class="close" onclick="hidePanel('panelFunctions')">×</button></header>
    <div class="content" id="funcContent"></div>
  </div>
  <div id="panelUnits" class="panel">
    <header>Units <button class="close" onclick="hidePanel('panelUnits')">×</button></header>
    <div class="content" id="unitContent"></div>
  </div>
  <div id="panelScripts" class="panel">
    <header>Scripts <button class="close" onclick="hidePanel('panelScripts')">×</button></header>
    <div class="content" id="scriptContent"></div>
  </div>

<script>
// ===== Tools (JS port of tools.py) =====
const DIGITS = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
function dec2rom(n){ n=Math.floor(Math.abs(n)); const digits=[["M",1000],["D",500],["C",100],["L",50],["X",10],["V",5],["I",1]]; let s=""; let chop=n; for(const [sym,val] of digits){ while(chop>=val){ s+=sym; chop-=val; } } return s.replace("IIII","IV").replace("VIV","IX").replace("XXXX","XL").replace("LXL","XC").replace("CCCC","CD").replace("DCD","CM"); }
function rom2dec(s){ s=s.replace("IV","IIII").replace("IX","VIIII").replace("XL","XXXX").replace("XC","LXXXX").replace("CD","CCCC").replace("CM","DCCCC"); const map={M:1000,D:500,C:100,L:50,X:10,V:5,I:1}; let dec=0; for(const c of s){ dec+=map[c]||0; } return dec; }
function dec2base(n,base){ if(base==='r') return dec2rom(n); base=parseInt(base,10); if(isNaN(base)||base<2||base>36) return ''; const neg=n<0; n=Math.abs(n); let int=Math.floor(n), frac=n-int, s=''; do{ s=DIGITS[int%base]+s; int=Math.floor(int/base); }while(int>0); if(frac>0){ s+='.'; let count=0; while(frac>0 && count<20){ frac*=base; s+=DIGITS[Math.floor(frac)]; frac-=Math.floor(frac); count++; } } return neg?('-'+s):s; }
function base2dec(n,base){ if(base==='r') return rom2dec(n); base=parseInt(base,10); if(isNaN(base)||base<2||base>36) return ''; let neg=false; if(n.startsWith('-')){ neg=true; n=n.slice(1);} const parts=n.toUpperCase().split('.'); let res=0; for(const ch of parts[0]){ const ix=DIGITS.indexOf(ch); if(ix<0||ix>=base) return ''; res=base*res+ix; } if(parts.length>1){ let pow=-1; for(const ch of parts[1]){ const ix=DIGITS.indexOf(ch); if(ix<0||ix>=base) return ''; res+=Math.pow(base,pow)*ix; pow--; } } return neg?(-res):res; }
function findEnd(cmd,arr){ let end=cmd.length; for(const endit of arr){ const i=cmd.indexOf(endit,1); if(i>=0){ end=Math.min(end,i);} } return end; }

// Full unitDict from Units.csv
const unitDict = {"m": {"Description": "Meters", "Group": "Length", "Conv": "1", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "ft": {"Description": "Feet", "Group": "Length", "Conv": "0.3048", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "mi": {"Description": "Mile", "Group": "Length", "Conv": "1609.344", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "km": {"Description": "Kilometers", "Group": "Length", "Conv": "1000", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "cm": {"Description": "centimeter", "Group": "Length", "Conv": "0.01", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "mm": {"Description": "millimeter", "Group": "Length", "Conv": "0.001", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "yd": {"Description": "Yards", "Group": "Length", "Conv": "0.9144", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "in": {"Description": "Inches", "Group": "Length", "Conv": "0.0254", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "mpc": {"Description": "megaparsec", "Group": "Length", "Conv": "3.09E+22", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "pc": {"Description": "parsec", "Group": "Length", "Conv": "3.09E+16", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "lyr": {"Description": "lightyear", "Group": "Length", "Conv": "9.46E+15", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "au": {"Description": "astronomical unit", "Group": "Length", "Conv": "1.5E+11", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "nmi": {"Description": "nautical mile", "Group": "Length", "Conv": "1.85E+03", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "mius": {"Description": "???", "Group": "Length", "Conv": "1.61E+03", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "chain": {"Description": "chain", "Group": "Length", "Conv": "2.01E+01", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "rd": {"Description": "rod", "Group": "Length", "Conv": "5.03E+00", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "fath": {"Description": "fathom", "Group": "Length", "Conv": "1.83E+00", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "ftus": {"Description": "???", "Group": "Length", "Conv": "3.05E-01", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "mil": {"Description": "???", "Group": "Length", "Conv": "2.54E-05", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "micr": {"Description": "micron", "Group": "Length", "Conv": "1E-06", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "a": {"Description": "angstrom", "Group": "Length", "Conv": "1E-10", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "fermi": {"Description": "Fermi", "Group": "Length", "Conv": "1E-15", "Length": "1", "Mass": "0", "Time": "0", "Temperature": "0"}, "s": {"Description": "Seconds", "Group": "Time", "Conv": "1", "Length": "0", "Mass": "0", "Time": "1", "Temperature": "0"}, "min": {"Description": "Minutes", "Group": "Time", "Conv": "60", "Length": "0", "Mass": "0", "Time": "1", "Temperature": "0"}, "hr": {"Description": "Hours", "Group": "Time", "Conv": "3600", "Length": "0", "Mass": "0", "Time": "1", "Temperature": "0"}, "day": {"Description": "days", "Group": "Time", "Conv": "86400", "Length": "0", "Mass": "0", "Time": "1", "Temperature": "0"}, "week": {"Description": "Weeks", "Group": "Time", "Conv": "604800", "Length": "0", "Mass": "0", "Time": "1", "Temperature": "0"}, "month": {"Description": "Months", "Group": "Time", "Conv": "2678400", "Length": "0", "Mass": "0", "Time": "1", "Temperature": "0"}, "yr": {"Description": "Years", "Group": "Time", "Conv": "31536000", "Length": "0", "Mass": "0", "Time": "1", "Temperature": "0"}, "mph": {"Description": "Miles Per Hour", "Group": "Velocity", "Conv": "0.444444444", "Length": "1", "Mass": "0", "Time": "-1", "Temperature": "0"}, "KPH": {"Description": "kilometers per hour", "Group": "Velocity", "Conv": "2.78E-01", "Length": "1", "Mass": "0", "Time": "-1", "Temperature": "0"}, "Knot": {"Description": "Knots", "Group": "Velocity", "Conv": "5.14E-01", "Length": "1", "Mass": "0", "Time": "-1", "Temperature": "0"}, "c": {"Description": "Lightspeed", "Group": "Velocity", "Conv": "3E+08", "Length": "1", "Mass": "0", "Time": "-1", "Temperature": "0"}, "b": {"Description": "???", "Group": "Area", "Conv": "1E-28", "Length": "2", "Mass": "0", "Time": "0", "Temperature": "0"}, "ha": {"Description": "Hectares", "Group": "Area", "Conv": "1E+04", "Length": "2", "Mass": "0", "Time": "0", "Temperature": "0"}, "acre": {"Description": "Acre", "Group": "Area", "Conv": "4.04686E+03", "Length": "2", "Mass": "0", "Time": "0", "Temperature": "0"}, "st": {"Description": "???", "Group": "Volume", "Conv": "1E+00", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "l": {"Description": "Liter", "Group": "Volume", "Conv": "1E-03", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "galUK": {"Description": "Gallon UK", "Group": "Volume", "Conv": "4.55E-03", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "galC": {"Description": "Gallon C", "Group": "Volume", "Conv": "4.55E-03", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "gal": {"Description": "Gallon", "Group": "Volume", "Conv": "0.00378541", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "qt": {"Description": "Quart", "Group": "Volume", "Conv": "9.46E-04", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "pt": {"Description": "Pint", "Group": "Volume", "Conv": "4.73E-04", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "ml": {"Description": "Milliliter", "Group": "Volume", "Conv": "1E-06", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "cu": {"Description": "???", "Group": "Volume", "Conv": "2.37E-04", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "ozfl": {"Description": "Fluid Ounce", "Group": "Volume", "Conv": "2.96E-05", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "ozuk": {"Description": "UK Fluid Ounce", "Group": "Volume", "Conv": "2.84E-05", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "tbsp": {"Description": "Tablespoon", "Group": "Volume", "Conv": "1.48E-05", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "tsp": {"Description": "Teaspoon", "Group": "Volume", "Conv": "4.93E-06", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "bbl": {"Description": "???", "Group": "Volume", "Conv": "1.59E-01", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "bu": {"Description": "???", "Group": "Volume", "Conv": "3.52E-02", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "pk": {"Description": "???", "Group": "Volume", "Conv": "8.81E-03", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "fbm": {"Description": "???", "Group": "Volume", "Conv": "0.002359737", "Length": "3", "Mass": "0", "Time": "0", "Temperature": "0"}, "hz": {"Description": "Hertz", "Group": "Misc", "Conv": "1", "Length": "0", "Mass": "0", "Time": "-1", "Temperature": "0"}, "kg": {"Description": "kilogram", "Group": "Mass", "Conv": "1E+03", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "g": {"Description": "gram", "Group": "Mass", "Conv": "1E+00", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "lb": {"Description": "pound", "Group": "Mass", "Conv": "4.54E+02", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "oz": {"Description": "ounce mass", "Group": "Mass", "Conv": "2.83E+01", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "slug": {"Description": "slug", "Group": "Mass", "Conv": "1.46E+04", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "lbt": {"Description": "???", "Group": "Mass", "Conv": "3.73E+02", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "ton": {"Description": "ton", "Group": "Mass", "Conv": "9.07E+05", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "tonu": {"Description": "???", "Group": "Mass", "Conv": "1.02E+06", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "t": {"Description": "???", "Group": "Mass", "Conv": "1E+06", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "ozt": {"Description": "???", "Group": "Mass", "Conv": "31.1034768", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "ct": {"Description": "???", "Group": "Mass", "Conv": "0.2", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "grain": {"Description": "grain", "Group": "Mass", "Conv": "0.06479891", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "u": {"Description": "???", "Group": "Mass", "Conv": "1.66E-24", "Length": "0", "Mass": "1", "Time": "0", "Temperature": "0"}, "mol": {"Description": "mol items", "Group": "Misc", "Conv": "6.02E+23", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "0"}, "n": {"Description": "newton", "Group": "Force", "Conv": "1000", "Length": "1", "Mass": "1", "Time": "-2", "Temperature": "0"}, "dyn": {"Description": "decinewtn", "Group": "Force", "Conv": "0.01", "Length": "1", "Mass": "1", "Time": "-2", "Temperature": "0"}, "gf": {"Description": "???", "Group": "Force", "Conv": "9.80665", "Length": "1", "Mass": "1", "Time": "-2", "Temperature": "0"}, "kip": {"Description": "???", "Group": "Force", "Conv": "4448221.615", "Length": "1", "Mass": "1", "Time": "-2", "Temperature": "0"}, "lbf": {"Description": "pounds force", "Group": "Force", "Conv": "4448.221615", "Length": "1", "Mass": "1", "Time": "-2", "Temperature": "0"}, "pdl": {"Description": "???", "Group": "Force", "Conv": "138.2549544", "Length": "1", "Mass": "1", "Time": "-2", "Temperature": "0"}, "deg": {"Description": "Degrees", "Group": "Misc", "Conv": "1", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "0"}, "rad": {"Description": "Radians", "Group": "Misc", "Conv": "1.75E-02", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "0"}, "grad": {"Description": "Gradians", "Group": "Misc", "Conv": "1.111111111", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "0"}, "tF": {"Description": "Farenheit", "Group": "Temperature", "Conv": "0.555555556", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "1"}, "tC": {"Description": "Celscius", "Group": "Temperature", "Conv": "1", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "1"}, "tK": {"Description": "Kelvin", "Group": "Temperature", "Conv": "1", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "1"}, "tR": {"Description": "Rakine", "Group": "Temperature", "Conv": "0.555555556", "Length": "0", "Mass": "0", "Time": "0", "Temperature": "1"}, "j": {"Description": "Joule", "Group": "Energy", "Conv": "0.001", "Length": "2", "Mass": "1", "Time": "-2", "Temperature": "0"}, "w": {"Description": "Watt", "Group": "Power", "Conv": "0.001", "Length": "2", "Mass": "1", "Time": "-1", "Temperature": "0"}};

function unitGrab(untString){ let unts={}; let inv=1; let s=untString; function findEndU(ustr){ let end=ustr.length; const slash=ustr.indexOf('/'); if(slash>0) end=Math.min(end,slash); const sp=ustr.indexOf(' '); if(sp>0) end=Math.min(end,sp); return end; } while(s.length>0){ s=s.trim(); if(!s) break; if(s[0]==='/'){ inv*=-1; s=s.slice(1); continue; } const bit=s.slice(0,findEndU(s)).trim(); s=s.slice(findEndU(s)); let key=bit; if(!(key in unitDict)){ if(bit.toLowerCase() in unitDict) key=bit.toLowerCase(); else if(bit.toUpperCase() in unitDict) key=bit.toUpperCase(); else { unts['notfound']=true; return unts; } } unts[key]=(unts[key]||0)+inv; } for(const U of Object.keys(unts)){ if(unts[U]===0) delete unts[U]; } return unts; }
function unitPrint(unts){ let pos='',neg=''; for(const [u,p] of Object.entries(unts)){ if(p>1) pos+=u+String(p)+' '; else if(p===1) pos+=u+' '; } for(const [u,p] of Object.entries(unts)){ if(p<-1) neg+=u+String(-p)+' '; else if(p===-1) neg+=u+' '; } pos=pos.trim(); neg=neg.trim(); return pos + (neg?('/'+neg):''); }
function unitPrintSuperscript(unts){ let pos=[], neg=[]; for (const [u,p] of Object.entries(unts)) { if (p>0) pos.push(u + (p>1 ? `<sup>${p}</sup>` : '')); else if (p<0) neg.push(u + (p<-1 ? `<sup>${-p}</sup>` : '')); } let s = pos.join(' '); if (neg.length) s += ' / ' + neg.join(' '); return s; }
function unitReport(unt){ let L=0,M=0,T=0,Te=0; for(const u of Object.keys(unt)){ const p=unt[u]; const d=unitDict[u]; L+=parseInt(d.Length)*p; M+=parseInt(d.Mass)*p; T+=parseInt(d.Time)*p; Te+=parseInt(d.Temperature)*p; } return [L,M,T,Te]; }
function unitCong(unt1,unt2){ const a=unitReport(unt1), b=unitReport(unt2); return a[0]===b[0] && a[1]===b[1] && a[2]===b[2] && a[3]===b[3]; }
function unitEq(unt1,unt2){ return JSON.stringify(unt1)===JSON.stringify(unt2); }
function unitConv(unt1,unt2){ let uMul=1.0; for(const U of Object.keys(unt1)){ const conv=Math.pow(parseFloat(unitDict[U].Conv), unt1[U]); uMul/=conv; } for(const U of Object.keys(unt2)){ const conv=Math.pow(parseFloat(unitDict[U].Conv), unt2[U]); uMul*=conv; } return uMul; }
function unitComb(unt1,mul1,unt2,mul2){ const out={}; for(const U of Object.keys(unt1)) out[U]=(out[U]||0)+unt1[U]*parseInt(mul1); for(const U of Object.keys(unt2)) out[U]=(out[U]||0)+unt2[U]*parseInt(mul2); return out; }
function unitSplit(unt1,mul1){ const out={}; for(const U of Object.keys(unt1)) out[U]=Math.trunc(unt1[U]/mul1); return out; }

// ===== classes.py (JS port) =====
class RegVal{ constructor(base,val,name='',units={}){ this.Base=base; this.Val=val; this.Name=name; this.Units=units; } }
class Stack{ constructor(){ this.Stack=[]; this.History=[]; } Insert(newReg){ this.Stack.push(newReg);} GetIndex(Index){ return this.Stack.at(Index);} GetName(Name){ for(const r of this.Stack) if(r.Name===Name) return r; return -1;} Size(){ return this.Stack.length;} Drop(Index){ this.Stack.splice(Index<0?this.Stack.length+Index:Index,1);} Remember(){ this.History.push(JSON.parse(JSON.stringify(this.Stack))); } Undo(clearit=false){ this.Stack.length=0; if(!clearit){ if(this.History.length>1) this.Stack = JSON.parse(JSON.stringify(this.History[this.History.length-2])); if(this.History.length>0) this.History.pop(); } else { this.History.length=0; } } FindName(Name){ return this.Stack.some(r=>r.Name===Name); } }

// ===== functions.py (JS port) =====
class rpnFunction{ constructor(){ this.Group=''; this.Name=''; this.Description=''; this.Consume=0; this.Create=0; } populate(Group,Name,Description,Consume,Create){ this.Group=Group; this.Name=Name; this.Description=Description; this.Consume=Consume; this.Create=Create; } }
class cmdADD extends rpnFunction{ constructor(){ super(); this.populate('Simple Math','Addition','Adds stack Registers 1 and 2. Result replaces them',2,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); let cnv=1.0; if(unitCong(ne1.Units,ne2.Units)){ if(!unitEq(ne1.Units,ne2.Units)) cnv=unitConv(ne2.Units,ne1.Units); Stack.Drop(-1); Stack.Drop(-1); const res=new RegVal(ne2.Base, ne1.Val*cnv+ne2.Val, ne2.Name, ne2.Units); Stack.Insert(res);} else return 'OK:Incongruent Units'; } catch(e){ return 'ADD generated unhandled Exception'; } } }
class cmdSUB extends rpnFunction{ constructor(){ super(); this.populate('Simple Math','Subtraction','Subtracts register 1 from 2',2,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); let cnv=1.0; if(unitCong(ne1.Units,ne2.Units)){ if(!unitEq(ne1.Units,ne2.Units)) cnv=unitConv(ne2.Units,ne1.Units); Stack.Drop(-1); Stack.Drop(-1); const res=new RegVal(ne2.Base, ne2.Val - ne1.Val*cnv, ne2.Name, ne2.Units); Stack.Insert(res);} else return 'OK:Incongruent Units'; } catch(e){ return 'Command SUB generated unhandled Exception'; } } }
class cmdMUL extends rpnFunction{ constructor(){ super(); this.populate('Simple Math','Multiplication','Multiplies registers 2 and 1',2,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); const res=new RegVal(ne2.Base, ne2.Val*ne1.Val, ne2.Name, unitComb(ne2.Units,1,ne1.Units,1)); Stack.Drop(-1); Stack.Drop(-1); Stack.Insert(res);} catch(e){ return 'Command MUL generated unhandled Exception'; } } }
class cmdDIV extends rpnFunction{ constructor(){ super(); this.populate('Simple Math','Division','Divides register 2 by 1',2,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); const res=new RegVal(ne2.Base, ne2.Val/ne1.Val, ne2.Name, unitComb(ne2.Units,1,ne1.Units,-1)); Stack.Drop(-1); Stack.Drop(-1); Stack.Insert(res);} catch(e){ return 'Command DIV generated unhandled Exception'; } } }
class cmdXPY extends rpnFunction{ constructor(){ super(); this.populate('Advanced','Power','Raises 2 to power of 1',2,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); const res=new RegVal(ne2.Base, Math.pow(ne2.Val, ne1.Val), ne2.Name, unitComb(ne2.Units, parseInt(ne1.Val), {}, 0)); Stack.Drop(-1); Stack.Drop(-1); Stack.Insert(res);} catch(e){ return 'Command XPY generated unhandled Exception'; } } }
class cmdSQRT extends rpnFunction{ constructor(){ super(); this.populate('Advanced','Square Root','sqrt of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.sqrt(ne1.Val), ne1.Name, unitSplit(ne1.Units,2)); Stack.Drop(-1); Stack.Insert(res);} catch(e){ return 'Command SQRT generated unhandled Exception'; } } }
class cmdSQR extends rpnFunction{ constructor(){ super(); this.populate('Advanced','Square','Squares register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.pow(ne1.Val,2), ne1.Name, unitComb(ne1.Units,2,{},0)); Stack.Drop(-1); Stack.Insert(res);} catch(e){ return 'Command SQR generated unhandled Exception'; } } }
class cmdXROOT extends rpnFunction{ constructor(){ super(); this.populate('Advanced','Root','Register 2 xth root using register 1',2,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); const res=new RegVal(ne2.Base, Math.pow(ne2.Val, 1/ne1.Val), ne2.Name, unitSplit(ne2.Units, ne1.Val)); Stack.Drop(-1); Stack.Drop(-1); Stack.Insert(res);} catch(e){ return 'Command XROOT generated unhandled Exception'; } } }
class cmdFACT extends rpnFunction{ constructor(){ super(); this.populate('Advanced','Factorial','Factorial of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); function fact(n){ n=Math.floor(n); let r=1; for(let i=2;i<=n;i++) r*=i; return r; } const res=new RegVal(ne1.Base, fact(ne1.Val), ne1.Name, {}); Stack.Drop(-1); Stack.Insert(res); if(Object.keys(ne1.Units).length>0) return 'OK: Units stripped from Factorial'; } catch(e){ return 'Command FACT generated unhandled Exception'; } } }
class cmdSIN extends rpnFunction{ constructor(){ super(); this.populate('Trigonometry','Sin','Sine of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.sin(parseInt(ne1.Val)), ne1.Name, {}); Stack.Drop(-1); Stack.Insert(res); if(Object.keys(ne1.Units).length>0) return 'OK: Units not impacted by SIN'; } catch(e){ return 'Command SIN generated unhandled Exception'; } } }
class cmdCOS extends rpnFunction{ constructor(){ super(); this.populate('Trigonometry','Cos','Cosine of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.cos(parseInt(ne1.Val)), ne1.Name, {}); Stack.Drop(-1); Stack.Insert(res); if(Object.keys(ne1.Units).length>0) return 'OK: Units not impacted by COS'; } catch(e){ return 'Command COS generated unhandled Exception'; } } }
class cmdTAN extends rpnFunction{ constructor(){ super(); this.populate('Trigonometry','Tan','Tangent of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.tan(parseInt(ne1.Val)), ne1.Name, {}); Stack.Drop(-1); Stack.Insert(res); if(Object.keys(ne1.Units).length>0) return 'OK: Units not impacted by TAN'; } catch(e){ return 'Command TAN generated unhandled Exception'; } } }
class cmdASIN extends rpnFunction{ constructor(){ super(); this.populate('Trigonometry','ASin','Arc-sine of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.asin(parseInt(ne1.Val)), ne1.Name, {}); Stack.Drop(-1); Stack.Insert(res); if(Object.keys(ne1.Units).length>0) return 'OK: Units not impacted by ASIN'; } catch(e){ return 'Command ASIN generated unhandled Exception'; } } }
class cmdACOS extends rpnFunction{ constructor(){ super(); this.populate('Trigonometry','ACos','Arc-cosine of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.acos(parseInt(ne1.Val)), ne1.Name, {}); Stack.Drop(-1); Stack.Insert(res); if(Object.keys(ne1.Units).length>0) return 'OK: Units not impacted by ACOS'; } catch(e){ return 'Command ACOS generated unhandled Exception'; } } }
class cmdATAN extends rpnFunction{ constructor(){ super(); this.populate('Trigonometry','ATan','Arc-tangent of register 1',1,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, Math.atan(parseInt(ne1.Val)), ne1.Name, {}); Stack.Drop(-1); Stack.Insert(res); if(Object.keys(ne1.Units).length>0) return 'OK: Units not impacted by ATAN'; } catch(e){ return 'Command ATAN generated unhandled Exception'; } } }
class cmdDROP extends rpnFunction{ constructor(){ super(); this.populate('General','Drop','Drop top of stack',1,0);} execute(Stack){ try{ Stack.Drop(-1);} catch(e){ return 'Command DROP generated unhandled Exception'; } } }
class cmdDUP extends rpnFunction{ constructor(){ super(); this.populate('General','Duplicate','Duplicate top of stack',0,1);} execute(Stack){ try{ if(Stack.Size()<1) return 'OK: !! No Stack Entry to Duplicate'; const ne1=Stack.GetIndex(-1); const res=new RegVal(ne1.Base, ne1.Val, ne1.Name, JSON.parse(JSON.stringify(ne1.Units))); Stack.Insert(res);} catch(e){ return 'Command DUP generated unhandled Exception'; } } }
class cmdCBAS extends rpnFunction{ constructor(){ super(); this.populate('Base','Convert Base','Change base of Stack 2 using Stack 1',2,1);} execute(Stack){ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); ne2.Base=parseInt(ne1.Val); Stack.Drop(-1); } }
class cmdCROM extends rpnFunction{ constructor(){ super(); this.populate('Base','Convert Roman','Change base to Roman Numerals',1,0);} execute(Stack){ const ne1=Stack.GetIndex(-1); ne1.Base='r'; } }
class cmdCLR extends rpnFunction{ constructor(){ super(); this.populate('General','Clear Stack','Clears Entire Stack',0,0);} execute(Stack){ Stack.Stack.length=0; } }
class cmdUNDO extends rpnFunction{ constructor(){ super(); this.populate('General','Undo','Undo last entry',0,0);} execute(Stack){ Stack.Undo(false); return 'OK: UNDO'; } }
class cmdCLRU extends rpnFunction{ constructor(){ super(); this.populate('General','CLRU','Clears history',0,0);} execute(Stack){ Stack.Undo(true); return 'OK: UNDO'; } }
class cmdEXIT extends rpnFunction{ constructor(){ super(); this.populate('General','EXIT','Exits the application',0,0);} execute(Stack){ return 'EXIT:'; } }
class cmdQUIT extends rpnFunction{ constructor(){ super(); this.populate('General','QUIT','Exits the application',0,0);} execute(Stack){ return 'EXIT:'; } }
class cmdUCNG extends rpnFunction{ constructor(){ super(); this.populate('Units','Are Units Congruent','Units addable?',0,0);} execute(Stack){ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); return unitCong(ne1.Units,ne2.Units)?'OK:Units are congruent':'OK:Units are InCongruent'; } }
class cmdUEQ extends rpnFunction{ constructor(){ super(); this.populate('Units','Are Units Equal','Units identical?',0,0);} execute(Stack){ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); return unitEq(ne1.Units,ne2.Units)?'OK:Units are equal':'OK:Units are not equal'; } }
class cmdUREP extends rpnFunction{ constructor(){ super(); this.populate('Units','Report Makeup','Make-up of current unit',0,0);} execute(Stack){ const ne1=Stack.GetIndex(-1); return String(unitReport(ne1.Units)); } }
class cmdUCNV extends rpnFunction{ constructor(){ super(); this.populate('Units','Convert','Convert Units in Stack 2 to those in Stack 1',2,1);} execute(Stack){ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); if(unitCong(ne1.Units,ne2.Units)){ const newval=ne2.Val*unitConv(ne1.Units,ne2.Units); const res=new RegVal(ne2.Base,newval,ne2.Name,ne1.Units); Stack.Drop(-1); Stack.Drop(-1); Stack.Insert(res); return ''; } else return 'Units Not Congruents'; } }
class cmdUADD extends rpnFunction{ constructor(){ super(); this.populate('Units','Add','Add units of Stack 1 to Stack 2',2,1);} execute(Stack){ try{ const ne1=Stack.GetIndex(-1), ne2=Stack.GetIndex(-2); if(Object.keys(ne2.Units).length>0) return 'Stack 2 already has units'; const res=new RegVal(ne2.Base, ne2.Val, ne2.Name, ne1.Units); Stack.Drop(-1); Stack.Drop(-1); Stack.Insert(res); return ''; } catch(e){ return 'Command UADD generated unhandled Exception'; } } }
class cmdPI extends rpnFunction{ constructor(){ super(); this.populate('Constants','PI','Adds PI to Stack',0,1);} execute(Stack){ Stack.Insert(new RegVal(10, Math.PI, 'pi', {})); } }
class cmdE extends rpnFunction{ constructor(){ super(); this.populate('Constants','E','Adds e to Stack',0,1);} execute(Stack){ Stack.Insert(new RegVal(10, Math.E, 'e', {})); } }
class cmdAVGR extends rpnFunction{ constructor(){ super(); this.populate('Constants','Avegadro','Adds Avogadro number',0,1);} execute(Stack){ Stack.Insert(new RegVal(10, 6.0221409e+23, 'avgr', {})); } }
class Functions{ constructor(){ this.ADD=new cmdADD(); this.SUB=new cmdSUB(); this.MUL=new cmdMUL(); this.DIV=new cmdDIV(); this.DROP=new cmdDROP(); this.DUP=new cmdDUP(); this.CLR=new cmdCLR(); this.CBAS=new cmdCBAS(); this.CROM=new cmdCROM(); this.UNDO=new cmdUNDO(); this.CLRU=new cmdCLRU(); this.EXIT=new cmdEXIT(); this.QUIT=new cmdQUIT(); this.UCNG=new cmdUCNG(); this.UEQ=new cmdUEQ(); this.UREP=new cmdUREP(); this.UCNV=new cmdUCNV(); this.UADD=new cmdUADD(); this.XPY=new cmdXPY(); this.SQRT=new cmdSQRT(); this.SQR=new cmdSQR(); this.XROOT=new cmdXROOT(); this.FACT=new cmdFACT(); this.SIN=new cmdSIN(); this.COS=new cmdCOS(); this.TAN=new cmdTAN(); this.ASIN=new cmdASIN(); this.ACOS=new cmdACOS(); this.ATAN=new cmdATAN(); this.PI=new cmdPI(); this.E=new cmdE(); this.AVGR=new cmdAVGR(); } }
function creatDict(F){ const funDict={}; for(const k of Object.keys(F)){ const o=F[k]; if(o && o.Name){ const grp=o.Group, nam=o.Name, des=o.Description, cc=String(o.Consume)+':'+String(o.Create); (funDict[grp] ||= {}); funDict[grp][k] = [k, nam, des, cc]; } } return funDict; }

// ===== parseIt.py (JS port) =====
const F = new Functions();
const S = new Stack();
const scriptDict = { "one": {"Script":"1"}, "two": {"Script":"2"}, "grav": {"Script":"32.174 'ft' 1 's' 2 xpy div"} };
function parseEntry(cmd){ const msg=disect(cmd); if(msg==='' || msg==null){ S.Remember(); } if(msg==='OK: UNDO') return ''; return msg; }
function disect(cmd){ const FUN="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_"; const VAL="#.&-0123456789"; let message=""; let buildVal=false; let valBase=null; let valValue=""; let valName=""; let valUnits={}; if(cmd.length===0) cmd='DUP'; while(cmd.length>0){ cmd=cmd.replace(/^\s+/, ''); let endit=0; if(cmd[0]=='"'){ if(valName!==''){ enterValue(valBase,valValue,valName,valUnits); buildVal=false; valBase=null; valValue=""; valName=""; valUnits={}; } endit=findEnd(cmd,['"',' ']); valName=cmd.slice(1,endit); } else if(cmd[0]=="'"){ if(Object.keys(valUnits).length>0){ enterValue(valBase,valValue,valName,valUnits); buildVal=false; valBase=null; valValue=""; valName=""; valUnits={}; } endit=findEnd(cmd,["'"," "]); valUnits=unitGrab(cmd.slice(1,endit)); if('notfound' in valUnits) return 'Unit not found'; } else if(cmd[0]=="{"){ if(valBase!=null){ enterValue(valBase,valValue,valName,valUnits); buildVal=false; valBase=null; valValue=""; valName=""; valUnits={}; } endit=findEnd(cmd,["}"," "]); valBase=cmd.slice(1,endit); } else if(cmd[0]=="<"){ if(buildVal===true){ enterValue(valBase,valValue,valName,valUnits); buildVal=false; valBase=null; valValue=""; valName=""; valUnits={}; } endit=findEnd(cmd,[">"," "]); const varRequest=cmd.slice(1,endit); const newVal=S.GetName(varRequest); if(newVal!==-1){ S.Insert(new RegVal(newVal.Base, newVal.Val, "", newVal.Units)); } else { message+=':NAME NOT FOUND'; } } else if(cmd[0]=="/"){ if(buildVal===true){ enterValue(valBase,valValue,valName,valUnits); buildVal=false; valBase=null; valValue=""; valName=""; valUnits={}; } endit=findEnd(cmd,["/"," "]); const script=cmd.slice(1,endit); cmd=cmd.slice(endit+1); cmd=(scriptDict[script]?.Script||'') + ' ' + cmd; continue; } else if(FUN.indexOf(cmd[0])>=0){ if(buildVal===true){ enterValue(valBase,valValue,valName,valUnits); buildVal=false; valBase=null; valValue=""; valName=""; valUnits={}; } endit=findEnd(cmd,[" "]); const token=cmd.slice(0,endit).toUpperCase(); try{ const msgR=F[token].execute(S); if(typeof msgR==='string' && msgR) message=msgR; } catch(e){ return token+' Command Not Found'; } } else if(VAL.indexOf(cmd[0])>=0){ if(buildVal===true){ enterValue(valBase,valValue,valName,valUnits); valBase=null; valValue=""; valName=""; valUnits={}; } buildVal=true; endit=findEnd(cmd,[" "]); valValue=cmd.slice(0,endit); } else { return 'bad character'; } cmd=cmd.slice(endit+1); }
  if(buildVal===true){ enterValue(valBase,valValue,valName,valUnits); buildVal=false; valBase=null; valValue=""; valName=""; valUnits={}; }
  return message; }
function enterValue(valBase,valValue,valName,valUnits){ if(valBase==null) valBase=10; if(valValue[0]=='&'){ valValue=valValue.slice(1); valBase=16; } if(valValue[0]=='#') valValue=valValue.slice(1); let num; if(valBase!=10) num=base2dec(String(valValue), valBase); else num=parseFloat(valValue); S.Insert(new RegVal(valBase, num, valName, valUnits)); }

// ===== UI glue =====
const statusEl=document.getElementById('status');
const cmdEl=document.getElementById('cmd');
const stackBody=document.getElementById('stackBody');
function paintScreen(){
  clearStackTable();
  const StackSize=S.Stack.length;
  if(StackSize<6){
    for(let i=0;i<6-StackSize;i++){
      addRowCombined(String(5-i).padStart(2,'0')+':','', '');
    }
  }
  for(let regVal=0; regVal<StackSize; regVal++){
    const idx=(StackSize - regVal - 1);
    const pREG=String(idx).padStart(2,'0')+':';
    const RV=S.Stack[regVal];
    const pNAM=RV.Name;
    const pCOMB = formatCombined(RV);
    addRowCombined(pREG,pNAM,pCOMB);
  }
  const scroller=document.getElementById('stackView'); scroller.scrollTop=scroller.scrollHeight;
}
function clearStackTable(){ stackBody.innerHTML=''; }
function addRow(Reg,Name,Value,Units,Base){ const tr=document.createElement('tr'); const td=t=>{ const c=document.createElement('td'); c.textContent=t; return c; }; tr.appendChild(td(Reg)); tr.appendChild(td(Name)); tr.appendChild(td(Value)); tr.appendChild(td(Units)); tr.appendChild(td(Base)); stackBody.appendChild(tr); }
function formatCombined(RV){ const valueStr = dec2base(RV.Val, RV.Base); let baseStr = ''; if (String(RV.Base) !== '10') baseStr = `<sub>${RV.Base}</sub>`; const unitsStr = unitPrintSuperscript(RV.Units); let combined = valueStr + baseStr + (unitsStr ? ' ' + unitsStr : ''); return combined; }
function addRowCombined(Reg, Name, CombinedHTML){ const tr = document.createElement('tr'); const tdText = (t)=>{ const c=document.createElement('td'); c.textContent=t; return c; }; const tdHTML = (h)=>{ const c=document.createElement('td'); c.innerHTML=h; return c; }; tr.appendChild(tdText(Reg)); tr.appendChild(tdText(Name)); tr.appendChild(tdHTML(CombinedHTML)); stackBody.appendChild(tr); }

// R0.07 helpers for user interactions requested
function addUnitToTop(unitKey, power){ if (S.Size() < 1){ statusEl.textContent = 'OK: !! No Stack Entry to Add Units'; return; } const top = S.GetIndex(-1); const single = {}; single[unitKey] = power; top.Units = unitComb(top.Units, 1, single, 1); paintScreen(); }
function runFunctionToken(token){ const current = cmdEl.value.trim(); const full = current ? (current + ' ' + token) : token; cmdEl.value = full; const msg = parseEntry(full); statusEl.textContent = (!msg || msg==='') ? '...' : (msg.startsWith('OK:') ? msg.slice(3) : msg); paintScreen(); }

cmdEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ const msg=parseEntry(cmdEl.value); if(!msg || msg===''){ statusEl.textContent='...'; cmdEl.value=''; } else if(msg.startsWith('OK:')){ statusEl.textContent=msg.slice(3); cmdEl.value=''; } else if(msg==='EXIT:'){ statusEl.textContent='Exit requested'; } else { statusEl.textContent=msg; } paintScreen(); } });
function showPanel(id){ document.getElementById(id).style.display='block'; }
function hidePanel(id){ document.getElementById(id).style.display='none'; }

// R0.07: Functions panel now uses buttons that execute the function
function fillFunctions(){ const fc=document.getElementById('funcContent'); const dict=creatDict(F); fc.innerHTML=''; for(const grp of Object.keys(dict)){ const h=document.createElement('h4'); h.textContent=grp; fc.appendChild(h); const kv=document.createElement('div'); kv.className='kv'; for(const key of Object.keys(dict[grp])){ const v=dict[grp][key]; const kdiv=document.createElement('div'); const btn=document.createElement('button'); btn.textContent=v[0]; btn.addEventListener('click', ()=>{ runFunctionToken(v[0]); }); kdiv.appendChild(btn); const ddiv=document.createElement('div'); ddiv.textContent=v[2]+' ('+v[3]+')'; kv.appendChild(kdiv); kv.appendChild(ddiv); } fc.appendChild(kv); } }

// R0.07: Units panel now uses buttons; left-click adds unit, right-click adds inverse
function fillUnits(){ const uc=document.getElementById('unitContent'); uc.innerHTML=''; const groups={}; for(const [k,v] of Object.entries(unitDict)){ (groups[v.Group] ||= []); groups[v.Group].push({key:k,desc:v.Description}); } for(const g of Object.keys(groups)){ const h=document.createElement('h4'); h.textContent=g; uc.appendChild(h); const ul=document.createElement('ul'); for(const u of groups[g]){ const li=document.createElement('li'); const btn=document.createElement('button'); btn.textContent=u.key; btn.addEventListener('click', ()=>{ addUnitToTop(u.key, 1); }); btn.addEventListener('contextmenu', (e)=>{ e.preventDefault(); addUnitToTop(u.key, -1); }); li.appendChild(btn); const span=document.createElement('span'); span.textContent=' — '+u.desc; li.appendChild(span); ul.appendChild(li); } uc.appendChild(ul); } }

// Scripts panel unchanged
function fillScripts(){ const sc=document.getElementById('scriptContent'); sc.innerHTML=''; const ul=document.createElement('ul'); const scriptDict={"one":{"Script":"1"},"two":{"Script":"2"},"grav":{"Script":"32.174 'ft' 1 's' 2 xpy div"}}; for(const [k,v] of Object.entries(scriptDict)){ const li=document.createElement('li'); const btn=document.createElement('button'); btn.textContent=k; btn.addEventListener('click',()=>{ const msg=parseEntry('/'+k); statusEl.textContent=msg?msg:'...'; paintScreen(); }); li.appendChild(btn); const span=document.createElement('span'); span.textContent='  '+v.Script; li.appendChild(span); ul.appendChild(li); } sc.appendChild(ul); }

document.getElementById('btnFunctions').addEventListener('click',()=>{ fillFunctions(); showPanel('panelFunctions'); });
document.getElementById('btnUnits').addEventListener('click',()=>{ fillUnits(); showPanel('panelUnits'); });
document.getElementById('btnScripts').addEventListener('click',()=>{ fillScripts(); showPanel('panelScripts'); });
document.getElementById('btnSave').addEventListener('click',()=>{ const blob=new Blob([JSON.stringify(S.Stack,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='KeyCalc-Stack.json'; a.click(); URL.revokeObjectURL(a.href); });
document.getElementById('btnClear').addEventListener('click',()=>{ const msg=F.CLR.execute(S); statusEl.textContent=msg||'...'; paintScreen(); });

paintScreen();
</script>
</body>
</html>
